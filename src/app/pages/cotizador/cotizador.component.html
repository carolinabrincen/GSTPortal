<h2 class="content-block">Cotizaciones de Rutas</h2>

<div [id]="'myDiv'" class="content-block dx-card responsive-paddings">
  <!--#region :::: GRID PRINCIPAL::::  -->
  <dx-data-grid
    #rentGer
    id="gridContainer"
    [dataSource]="arrCotizaciones"
    [columnAutoWidth]="true"
    [showColumnLines]="true"
    [showBorders]="true"
    [rowAlternationEnabled]="true"
  >
    <dxo-search-panel
      [visible]="true"
      [width]="240"
      placeholder="Buscar..."
    ></dxo-search-panel>
    <!-- FOLIO -->
    <dxi-column
      dataField="folio"
      caption="Folio"
      alignment="center"
      headerCellTemplate="headerTemplate"
      cellTemplate="cellTemplateBold"
      fixed="true"
    ></dxi-column>
    <!-- STATUS -->
    <dxi-column
      dataField="status"
      caption="Status"
      alignment="center"
      headerCellTemplate="headerTemplate"
      cellTemplate="cellTemplateTag"
      fixed="true"
      [width]="120"
    ></dxi-column>
    <!-- UNIDAD DE NEGOCIO -->
    <dxi-column
      dataField="unidadNegocio"
      caption="Unidad de Negocio"
      headerCellTemplate="headerTemplate"
    ></dxi-column>
    <!-- TIPO OPERACION -->
    <dxi-column
      dataField="tipoOperacion"
      caption="Tipo de Operación"
      headerCellTemplate="headerTemplate"
    ></dxi-column>
    <!-- CLIENTE -->
    <dxi-column
      dataField="cliente"
      caption="Cliente"
      headerCellTemplate="headerTemplate"
    ></dxi-column>
    <!-- ORIGEN -->
    <dxi-column
      dataField="origen"
      caption="Origen"
      headerCellTemplate="headerTemplate"
    ></dxi-column>
    <!-- DESTINO -->
    <dxi-column
      dataField="destino"
      caption="Destino"
      alignment="left"
      format="percent"
      headerCellTemplate="headerTemplate"
    ></dxi-column>
    <!-- DISTANCIA TOTAL -->
    <dxi-column
      dataField="distanciaTotal"
      caption="Kms."
      alignment="right"
      format="fixedPoint"
      headerCellTemplate="headerTemplate"
    ></dxi-column>
    <!-- CASETAS -->
    <dxi-column
      dataField="casetas"
      caption="Casetas"
      alignment="right"
      headerCellTemplate="headerTemplate"
    >
      <dxo-format type="currency" [precision]="2"> </dxo-format>
    </dxi-column>
    <!-- DIESEL -->
    <dxi-column
      dataField="dieselFinal"
      caption="Diesel"
      alignment="right"
      headerCellTemplate="headerTemplate"
    >
      <dxo-format type="currency" [precision]="2"> </dxo-format>
    </dxi-column>
    <!-- TARIFA -->
    <dxi-column
      dataField="tarifa"
      caption="Tarifa"
      alignment="right"
      headerCellTemplate="headerTemplate"
    >
      <dxo-format type="currency" [precision]="2"> </dxo-format>
    </dxi-column>
    <!-- COSTO POR KM -->
    <dxi-column
      dataField="costoPorKm"
      caption="Costo KM"
      alignment="right"
      headerCellTemplate="headerTemplate"
    >
      <dxo-format type="currency" [precision]="2"> </dxo-format>
    </dxi-column>
    <!-- INGRESO POR KM -->
    <dxi-column
      dataField="ingresoPorKm"
      caption="Ingreso KM"
      alignment="right"
      headerCellTemplate="headerTemplate"
    >
      <dxo-format type="currency" [precision]="2"> </dxo-format>
    </dxi-column>
    <!-- TARIFA 25% -->
    <dxi-column
      dataField="tarifa25"
      caption="25%"
      alignment="right"
      headerCellTemplate="headerTemplate"
    >
      <dxo-format type="currency" [precision]="2"> </dxo-format>
    </dxi-column>
    <!-- TARIFA 35% -->
    <dxi-column
      dataField="tarifa35"
      caption="35%"
      alignment="right"
      headerCellTemplate="headerTemplate"
    >
      <dxo-format type="currency" [precision]="2"> </dxo-format>
    </dxi-column>
    <!-- TARIFA 40% -->
    <dxi-column
      dataField="tarifa40"
      caption="40%"
      alignment="right"
      headerCellTemplate="headerTemplate"
    >
      <dxo-format type="currency" [precision]="2"> </dxo-format>
    </dxi-column>
    <!-- TARIFA 45% -->
    <dxi-column
      dataField="tarifa45"
      caption="45%"
      alignment="right"
      headerCellTemplate="headerTemplate"
    >
      <dxo-format type="currency" [precision]="2"> </dxo-format>
    </dxi-column>
    <!-- % FINAL -->
    <dxi-column
      dataField="porcentajeFinal"
      caption="% Final"
      alignment="right"
      format="percent"
      [fixed]="true"
      fixedPosition="right"
      headerCellTemplate="headerTemplate"
      cellTemplate="cellTemplateBold"
    >
    </dxi-column>
    <!-- TARIFA FINAL -->
    <dxi-column
      dataField="tarifaFinal"
      caption="Tarifa Final"
      alignment="right"
      [fixed]="true"
      fixedPosition="right"
      headerCellTemplate="headerTemplate"
      cellTemplate="cellTemplateBold"
    >
      <dxo-format type="currency" [precision]="2"> </dxo-format>
    </dxi-column>

    <!-- BOTON EDITAR -->
    <dxi-column
      caption="Editar"
      headerCellTemplate="headerTemplate"
      type="buttons"
      [width]="60"
    >
      <dxi-button
        hint="Editar"
        icon="edit"
        [onClick]="editarCotizacionClick"
      ></dxi-button>
    </dxi-column>
    <!-- BOTON ELIMINAR -->
    <dxi-column
      caption="Elimnar"
      headerCellTemplate="headerTemplate"
      type="buttons"
      [width]="60"
    >
      <dxi-button
        hint="Eliminar"
        icon="trash"
        [onClick]="eliminarCotizcionClick"
      ></dxi-button>
    </dxi-column>

    <div *dxTemplate="let data of 'headerTemplate'">
      <div style="font-weight: bolder; color: black">
        {{ data.column.caption }}
      </div>
    </div>

    <div *dxTemplate="let info of 'titleHeaderTemplate'">
      <div style="font-weight: bolder; color: #ff5722">
        {{ info.column.caption }}
      </div>
    </div>

    <!-- TEMPLATE: CELDA EN NEGRITA -->
    <div *dxTemplate="let cell of 'cellTemplateBold'">
      <div style="font-weight: bold">{{ cell.text }}</div>
    </div>
    <!-- TEMPLATE: TAG -->
    <div
      *dxTemplate="let cell of 'cellTemplateTag'"
      (mouseleave)="bolBotonAprobarCotizacion = false"
    >
      <!-- TAG PRECOTIZACION -->
      <div
        *ngIf="
          cell.text === 'PRECOTIZACION' && bolBotonAprobarCotizacion == false
        "
        class="tag-naranja"
        (mouseover)="mouseoverAprobarCotizacion(cell)"
      >
        {{ cell.text }}
      </div>
      <!-- TAG APROBADA -->
      <div *ngIf="cell.text === 'APROBADA'" class="tag-verde">
        {{ cell.text }}
      </div>
      <!-- BOTON APROBAR COTIZACION -->
      <div
        *ngIf="cell.text === 'PRECOTIZACION' && bolBotonAprobarCotizacion"
      >
        <dx-button
          icon="check"
          type="danger"
          text="Aprobar"
          style="font-size: 9px !important; background-color: #ffc340 !important; color: black;"
          (onClick)="aprobarCotizacionClick(cell)"
        >
        </dx-button>
      </div>
    </div>

    <dxo-paging [pageSize]="10"></dxo-paging>
    <dxo-pager
      [visible]="true"
      [allowedPageSizes]="allowedPageSizes"
      displayMode="full"
      [showPageSizeSelector]="true"
      [showInfo]="true"
      [showNavigationButtons]="true"
    >
    </dxo-pager>
    <dxo-sorting mode="none"></dxo-sorting>
  </dx-data-grid>
  <!--#endregion :::: FIN GRID PRINCIPAL ::::  -->

  <!--#region :::: VENTANA MODAL NUEVO/EDITAR ::::  -->
  <dx-popup
    style="margin-top: 250px"
    [showTitle]="true"
    [title]="tituloModal"
    [dragEnabled]="false"
    [closeOnOutsideClick]="true"
    [showCloseButton]="true"
    container=".dx-viewport"
    [(visible)]="bolModal"
  >
    <dxo-position at="botom" my="center" [of]="positionOf"> </dxo-position>
    <div *dxTemplate="let data of 'content'">
      <!--#region :::: FORM DE CAPUTURA :::: -->
      <form action="" (submit)="guardarCotizacionClick($event)">
        <dx-form
          style="margin-left: 25px"
          id="form"
          [(formData)]="itemCotizacion"
          [colCount]="12"
          width="95%"
          validationGroup="customerData"
        >
          <!-- TIPO VIAJE -->
          <dxi-item
            dataField="tipoViaje"
            editorType="dxRadioGroup"
            [editorOptions]="RadioButtonOptions"
            [colSpan]="10"
          >
            <dxo-label text="Tipo De Viaje"> </dxo-label>
            <dxi-validation-rule
              style="margin-top: 5rem"
              type="required"
              message="campo requerido"
            ></dxi-validation-rule>
          </dxi-item>
          <!-- FOLIO -->
          <dxi-item
            dataField="folio"
            [editorOptions]="{ readOnly: true }"
            [colSpan]="2"
          ></dxi-item>
          <!-- UNIDAD NEGOCIO -->
          <dxi-item
            dataField="idUnidadNegocio"
            editorType="dxSelectBox"
            [editorOptions]="{
              items: arrUnidadesNegocio,
              searchEnabled: true,
              displayExpr: 'nombre',
              valueExpr: 'idUnidad'
            }"
            [colSpan]="6"
          >
            <dxo-label text="Unidad de Negocio"> </dxo-label>
            <dxi-validation-rule
              type="required"
              message="Unidad de Negocio es campo requerido"
            ></dxi-validation-rule>
          </dxi-item>
          <!-- TIPOS OPERACIONES -->
          <dxi-item
            dataField="idTipoOperacion"
            editorType="dxSelectBox"
            [editorOptions]="{
              items: arrTipoOperacion,
              searchEnabled: true,
              displayExpr: 'operacion',
              valueExpr: 'idTipoOperacion'
            }"
            [colSpan]="6"
          >
            <dxo-label text="Tipo de Operación"> </dxo-label>
            <dxi-validation-rule
              type="required"
              message="Tipo de Operación es campo requerido"
            ></dxi-validation-rule>
          </dxi-item>
          <!-- CLIENTE -->
          <dxi-item dataField="cliente" [colSpan]="12"> </dxi-item>
          <!-- ORIGEN -->
          <dxi-item dataField="origen" [colSpan]="6"> </dxi-item>
          <!-- DESTINO -->
          <dxi-item dataField="destino" [colSpan]="6"> </dxi-item>
          <!-- DISTANCIA IDA -->
          <dxi-item dataField="distanciaIda" [colSpan]="4"> </dxi-item>
          <!-- DISTANCIA RETORNO -->
          <dxi-item
            dataField="distanaciaRetorno"
            [colSpan]="4"
            [editorOptions]="{ readOnly: bolEsViajeSencillo }"
          >
          </dxi-item>
          <!-- DISTANCIA TOTAL -->
          <dxi-item dataField="distanciaTotal" [colSpan]="4"> </dxi-item>
          <!-- DIESEL -->
          <dxi-item dataField="diesel" [colSpan]="4"> </dxi-item>
          <!-- COSTO -->
          <dxi-item
            dataField="costo"
            [colSpan]="4"
            [editorOptions]="{ readOnly: true }"
          >
          </dxi-item>
          <!-- FAC. CARGA SOCIAL -->
          <dxi-item
            dataField="FactorCargaSolcial"
            [colSpan]="4"
            [editorOptions]="{ readOnly: true }"
          >
          </dxi-item>

          <!-- FLETE POR VIAJE -->
          <dxi-item dataField="fletePorViaje" [colSpan]="3"> </dxi-item>
          <!-- VEL. KMS/HRS -->
          <dxi-item
            dataField="velKmsHr"
            [colSpan]="3"
            [editorOptions]="{ readOnly: true }"
          >
            <dxo-label text="Vel. Kms/Hr."> </dxo-label>
          </dxi-item>
          <!-- TIEMPO CARGA -->
          <dxi-item dataField="tiempoCarga" [colSpan]="3"> </dxi-item>
          <!-- TIMEPO DESCARGA -->
          <dxi-item dataField="tiempoDescarga" [colSpan]="3"> </dxi-item>

          <!-- DESCANSOS -->
          <dxi-item dataField="descansos" [colSpan]="3"> </dxi-item>
          <!-- TRANSITO CARGADO -->
          <dxi-item
            dataField="transitoCargado"
            [colSpan]="3"
            [editorOptions]="{ readOnly: true }"
          >
          </dxi-item>
          <!-- TRANSITO VACIO -->
          <dxi-item
            dataField="transitoVacio"
            [colSpan]="3"
            [editorOptions]="{ readOnly: true }"
          >
          </dxi-item>
          <!-- TOTAL TIEMPO -->
          <dxi-item
            dataField="totalTiempo"
            [colSpan]="3"
            [editorOptions]="{ readOnly: true }"
          >
            <dxo-label text="TIEMPO TOTAL"> </dxo-label>
          </dxi-item>
          <!-- NUM LLANTAS -->
          <dxi-item
            dataField="numLlantas"
            [colSpan]="3"
            [editorOptions]="{ readOnly: true }"
          >
          </dxi-item>
          <!-- RENDIMIENTO KMS. -->
          <dxi-item
            dataField="rendimientoKms"
            [colSpan]="3"
            [editorOptions]="{ readOnly: true }"
          >
          </dxi-item>
          <!-- COSTO LLANTA -->
          <dxi-item
            dataField="costoLlanta"
            [colSpan]="3"
            [editorOptions]="{ readOnly: true }"
          >
          </dxi-item>
          <!-- COSTO LLANTA KM FULL -->
          <dxi-item
            dataField="costoLlantaKmFull"
            [colSpan]="3"
            [editorOptions]="{ readOnly: true }"
          >
            <dxo-label text="COSTO LLANTA KM FULL"> </dxo-label>
          </dxi-item>
          <!-- ESPACIO EN BLANCO -->
          <dxi-item itemType="empty" [colSpan]="12"></dxi-item>
          <!-- BOTON VER VARIABLES  -->
          <dxi-item
            itemType="button"
            horizontalAlignment="center"
            [buttonOptions]="buttonOptionsVariables"
            [colSpan]="3"
          >
          </dxi-item>
          <!-- BOTON PREVISUALIZAR  -->
          <dxi-item
            style="color: green"
            itemType="button"
            horizontalAlignment="center"
            [buttonOptions]="buttonOptionsPre"
            [colSpan]="3"
          >
          </dxi-item>
          <!-- BOTON IMPRIMIR  -->
          <dxi-item
            style="color: green"
            itemType="button"
            horizontalAlignment="center"
            [buttonOptions]="buttonOptionsImprimir"
            [colSpan]="3"
          >
          </dxi-item>
          <!-- BOTON GUARDAR  -->
          <dxi-item
            style="margin-top: 2rem"
            itemType="button"
            horizontalAlignment="center"
            [buttonOptions]="buttonOptions"
            [colSpan]="3"
          >
          </dxi-item>
        </dx-form>
      </form>

      <!--#endregion :::: FIN FORM CAPUTRA ::::  -->
    </div>
  </dx-popup>
  <!--#endregion :::: FIN VENTANA MODAL NUEVO/EDITAR ::::  -->

  <!--#region :::: MODAL VARIABLES ::::  -->
  <dx-popup
    height="580px"
    width="520px"
    style="margin-top: 250px"
    [showTitle]="true"
    title="Parametrización de Variables"
    [dragEnabled]="false"
    [closeOnOutsideClick]="true"
    [showCloseButton]="true"
    container=".dx-viewport"
    [(visible)]="bolModalVariables"
  >
    <dxo-position at="botom" my="center" [of]="positionOf"> </dxo-position>
    <div *dxTemplate="let data of 'content'">
      <!--#region :::: GRID VARIABLES :::: -->
      <dx-data-grid
        #variables
        id="gridVariables"
        [dataSource]="arrVariables"
        [columnAutoWidth]="true"
        [showColumnLines]="true"
        [showBorders]="true"
        [rowAlternationEnabled]="true"
      >
        <dxi-column
          dataField="descripcion"
          caption="Variable"
          [fixed]="true"
          alignment="left"
          headerCellTemplate="headerTemplate"
        ></dxi-column>
        <dxi-column
          dataField="valor"
          caption="Valor"
          [fixed]="true"
          headerCellTemplate="headerTemplate"
        ></dxi-column>
        <dxi-column
          dataField="fechaAct"
          caption="Fecha Actualización"
          [fixed]="true"
          alignment="center"
          format="dd/MM/yy"
          headerCellTemplate="headerTemplate"
        ></dxi-column>

        <div *dxTemplate="let data of 'headerTemplate'">
          <div style="font-weight: bolder; color: black">
            {{ data.column.caption }}
          </div>
        </div>

        <div *dxTemplate="let info of 'titleHeaderTemplate'">
          <div style="font-weight: bolder; color: #ff5722">
            {{ info.column.caption }}
          </div>
        </div>
      </dx-data-grid>

      <!--#endregion :::: FIN GRID VARIABLES ::::  -->
    </div>
  </dx-popup>

  <!--#endregion :::: FIN MODAL VARIABLES :::: -->

  <!--#region :::: MODAL DETALLE COTIZACION :::: -->
  <dx-popup
    height="750px"
    width="520px"
    style="margin-top: 250px"
    [showTitle]="true"
    title="Detalle de Cotización"
    [dragEnabled]="false"
    [closeOnOutsideClick]="true"
    [showCloseButton]="true"
    container=".dx-viewport"
    [(visible)]="bolModalDetalleCotizacion"
  >
    <dxo-position at="botom" my="center" [of]="positionOf"> </dxo-position>
    <div *dxTemplate="let data of 'content'">
      <!--#region :::: GRID DETALLE COTIZACION :::: -->
      <dx-data-grid
        #variables
        id="gridDetalleCotizacion"
        [dataSource]="arrDetalleCotizacion"
        [columnAutoWidth]="true"
        [showColumnLines]="true"
        [showBorders]="true"
        [rowAlternationEnabled]="true"
        height="650px"
      >
        <dxi-column
          dataField="descripcion"
          caption="Concepto"
          alignment="left"
          headerCellTemplate="headerTemplate"
        ></dxi-column>
        <dxi-column
          dataField="valor"
          caption="Valor"
          alignment="right"
          headerCellTemplate="headerTemplate"
        ></dxi-column>
        <dxi-column
          dataField="porcentaje"
          caption="%"
          format="percent"
          alignment="center"
          headerCellTemplate="headerTemplate"
        ></dxi-column>

        <div *dxTemplate="let data of 'headerTemplate'">
          <div style="font-weight: bolder; color: black">
            {{ data.column.caption }}
          </div>
        </div>

        <div *dxTemplate="let info of 'titleHeaderTemplate'">
          <div style="font-weight: bolder; color: #ff5722">
            {{ info.column.caption }}
          </div>
        </div>
        <dxo-paging [pageSize]="50"></dxo-paging>
      </dx-data-grid>

      <!--#endregion :::: FIN GRID DETALLE COTIZACION ::::  -->
    </div>
  </dx-popup>
  <!--#endregion :::: FIN MODAL DETALLE COTIZACION :::: -->
</div>
<dx-speed-dial-action
  icon="add"
  label="Nueva Cotización"
  [index]="1"
  (onClick)="nuevaCotizacionClick()"
  style="left: -1132px; top: -699px"
>
</dx-speed-dial-action>
